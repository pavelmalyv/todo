import{r as c,j as s,A as C,B as x,e as N,s as F,S as k,m as y,E as f,o as w,p as R,q as I,t as _,h as q,u as P,N as U,v as A,w as G}from"./index-BgGn9oyM.js";import{T as B}from"./TasksPage-CVJiKMRN.js";import{u as z}from"./useTagSnapshot-CDeYcPuL.js";import{u as W,o as $,S as b,C as v,F as H,h as J,n as K}from"./fields-p-xqUCFQ.js";import{b as Q,F as V,C as X}from"./EditTaskModal-BSccCvCv.js";import"./TasksList-vfbFSC3_.js";import"./MessageInfo-CGDtvxrt.js";import"./Checkbox-CnUwm7zQ.js";const Y=N({name:K,color:J}),Z=({initialData:e,isLoadingData:r=!1,isOpen:a,onClose:t,onBeforeDelete:o,onAfterDelete:d})=>{const u=c.useId(),[j,l]=c.useState(!1),{updateTag:i,deleteTag:m}=Q(),g=e==null,{control:E,formState:p,handleSubmit:L,reset:T}=W({resolver:$(Y)});c.useEffect(()=>{p.isDirty||T({name:(e==null?void 0:e.name)??"",color:(e==null?void 0:e.color)??""})},[p.isDirty,e==null?void 0:e.name,e==null?void 0:e.color,T]);const M=async n=>{if(e)try{await i.update(e.id,n),T(n),t(),F(k.saveTag)}catch{y(f.saveTag)}},O=async()=>{if(e)try{o==null||o(),await m.delete(e.id),t(),l(!1),F(k.deleteTag)}catch{y(f.deleteTag)}finally{d==null||d()}};return s.jsxs(s.Fragment,{children:[s.jsxs(C,{isOpen:a,onClose:t,"aria-labelledby":u,children:[s.jsx(C.Title,{id:u,children:"Редактировать тег"}),s.jsxs(b,{isLoading:i.isLoading,onSubmit:L(M),children:[s.jsx(v,{name:"name",control:E,render:({field:n,fieldState:S})=>{var h;return s.jsx(H,{label:"Название тега",placeholder:"Название тега",isLoading:r,isSkeleton:g,"aria-required":!0,"aria-invalid":S.invalid,errorMessage:(h=S.error)==null?void 0:h.message,...n})}}),s.jsx(v,{name:"color",control:E,render:({field:n,fieldState:S})=>{var h;return s.jsx(V,{label:"Цвет:",ref:n.ref,name:n.name,value:n.value,onChange:n.onChange,isLoading:r,isSkeleton:g,"aria-required":!0,"aria-invalid":S.invalid,errorMessage:(h=S.error)==null?void 0:h.message})}}),s.jsx(b.Footer,{children:s.jsxs(C.Buttons,{children:[s.jsx(x,{isSkeleton:g,isLoadingSkeleton:r,styleType:"delete",isFull:!0,onClick:()=>l(!0),children:"Удалить"}),s.jsx(x,{styleType:"border",isSkeleton:g,isLoadingSkeleton:r,isFull:!0,onClick:()=>T(),disabled:!p.isDirty,children:"Сбросить"}),s.jsx(x,{type:"submit",isLoading:i.isLoading,isSkeleton:g,isLoadingSkeleton:r,isFull:!0,disabled:!p.isDirty,children:"Обновить"})]})})]})]}),s.jsx(X,{title:"Удаление тега",description:"Вы уверены, что хотите удалить тег? Это действие нельзя будет отменить",buttonConfirmName:"Удалить",isOpen:j,isLoading:m.isLoading,onClose:()=>l(!1),onClickConfirm:O})]})},D=(e,r)=>{const a=w();c.useEffect(()=>{e&&a(r)},[e,r,a])},le=()=>{const e=R(),r=I(e.id),[a,t]=c.useState(!1),[o,d,u]=z(r),[j,l]=c.useState(!1),i=a&&G(u),m=a?void 0:u;return D(i,A),_(m),q(f.tagNameLoading,m),P(o==null?void 0:o.name),s.jsxs(s.Fragment,{children:[s.jsx(B,{title:(o==null?void 0:o.name)??null,isLoadingTitle:d,errorMessageTasksLoading:f.tasksLoading,notFoundMessage:U.tasks,tagId:r,headButtons:s.jsx(x,{size:"small",styleType:"border",onClick:()=>l(!0),children:"Редактировать тег"})}),s.jsx(Z,{initialData:o,isLoadingData:d,isOpen:j,onClose:()=>l(!1),onBeforeDelete:()=>t(!0),onAfterDelete:()=>t(!1)})]})};export{le as default};
