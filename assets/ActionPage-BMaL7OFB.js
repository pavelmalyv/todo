import{r as d,at as b,b as E,n as g,e as P,o as x,j as i,s as v,S as j,L as h,au as L,av as M,u as k,E as y}from"./index-BgGn9oyM.js";import{g as I,b as T,u as O,o as _,S as F,C as S,F as f}from"./fields-p-xqUCFQ.js";import{g as R}from"./firebase-DYMQJXm9.js";import{B as p}from"./Book-6ciNcP9H.js";import{M as B}from"./MessageInfo-CGDtvxrt.js";const U=()=>{const[r,o]=d.useState(!1),[a,c]=d.useState(void 0);return[d.useCallback(async(l,n)=>{try{o(!0),await b(E,l,n)}catch(e){console.log(e);const s=g(e);throw c(s),s}finally{o(!1)}},[]),r,a]},D=P({password:T,passwordRepeat:I("password")}),N=({code:r})=>{const o=x(),[a,c,t]=U(),l=t?R(t):void 0,{handleSubmit:n,control:e,reset:s}=O({resolver:_(D),defaultValues:{password:"",passwordRepeat:""}}),C=async u=>{await a(r,u.password),v(j.confirmPasswordReset),o(h),s()};return i.jsxs(F,{onSubmit:n(C),buttonName:"Сохранить",errorMessage:l,isLoading:c,children:[i.jsx(S,{name:"password",control:e,render:({field:u,fieldState:m})=>{var w;return i.jsx(f,{label:"Пароль",placeholder:"Пароль*",isPassword:!0,autoComplete:"new-password",...u,"aria-required":!0,"aria-invalid":m.invalid,errorMessage:(w=m.error)==null?void 0:w.message})}}),i.jsx(S,{name:"passwordRepeat",control:e,render:({field:u,fieldState:m})=>{var w;return i.jsx(f,{label:"Повтор пароля",placeholder:"Повтор пароля*",isPassword:!0,autoComplete:"new-password",...u,"aria-required":!0,"aria-invalid":m.invalid,errorMessage:(w=m.error)==null?void 0:w.message})}})]})},G=r=>{const[o,a]=d.useState(!0),[c,t]=d.useState(void 0),[l,n]=d.useState(null),e=L(window.location.href);return d.useEffect(()=>{(async()=>{try{if(!(e!=null&&e.operation))throw new Error("Invalid action in the URL");if(!r.includes(e.operation))throw new Error("The action is not supported");a(!0),await M(E,e.code),n(e.code)}catch(s){t(g(s)),console.error(s)}finally{a(!1)}})()},[e==null?void 0:e.operation,e==null?void 0:e.code,r]),[l,(e==null?void 0:e.operation)??null,o,c]},W=["PASSWORD_RESET"],H=()=>{k();const r=d.useId(),[o,a,c,t]=G(W),l=t?R(t):void 0;let n;switch(a){case"PASSWORD_RESET":n="Сброс пароля";break;default:n="Ошибка"}let e,s=!0;if(t||!o)e=i.jsx(B,{message:l??y.unknown}),s=!1;else switch(a){case"PASSWORD_RESET":{e=i.jsx(N,{code:o});break}}return i.jsx(p,{"aria-labelledby":r,children:i.jsx(p.Main,{title:n,titleId:r,isLoading:c,backButton:{to:h,isCenter:s,text:"Отмена"},children:e})})};export{H as default};
