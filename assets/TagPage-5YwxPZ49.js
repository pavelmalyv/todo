import{r as c,j as s,A as C,B as x,e as N,s as F,S as k,m as y,E as f,o as w,p as I,q as R,t as q,h as P,u as _,N as G,v as U}from"./index-DZnvPZAH.js";import{T as A}from"./TasksPage-Bx4yWokn.js";import{u as z}from"./useTagSnapshot-CBIpAJu3.js";import{u as B,o as W,S as b,C as v,F as $,h as H,n as J}from"./fields-Z0O1DHnl.js";import{b as K,F as Q,C as V}from"./EditTaskModal-D3vliasy.js";import"./TasksList-CxOSD4Wb.js";import"./MessageInfo-hB-86Cfu.js";import"./Checkbox-CXGVtCPz.js";const X=N({name:J,color:H}),Y=({initialData:e,isLoadingData:r=!1,isOpen:a,onClose:t,onBeforeDelete:o,onAfterDelete:d})=>{const u=c.useId(),[j,l]=c.useState(!1),{updateTag:i,deleteTag:m}=K(),g=e==null,{control:E,formState:p,handleSubmit:L,reset:T}=B({resolver:W(X)});c.useEffect(()=>{p.isDirty||T({name:(e==null?void 0:e.name)??"",color:(e==null?void 0:e.color)??""})},[p.isDirty,e==null?void 0:e.name,e==null?void 0:e.color,T]);const M=async n=>{if(e)try{await i.update(e.id,n),T(n),t(),F(k.saveTag)}catch{y(f.saveTag)}},O=async()=>{if(e)try{o==null||o(),await m.delete(e.id),t(),l(!1),F(k.deleteTag)}catch{y(f.deleteTag)}finally{d==null||d()}};return s.jsxs(s.Fragment,{children:[s.jsxs(C,{isOpen:a,onClose:t,"aria-labelledby":u,children:[s.jsx(C.Title,{id:u,children:"Редактировать тег"}),s.jsxs(b,{isLoading:i.isLoading,onSubmit:L(M),children:[s.jsx(v,{name:"name",control:E,render:({field:n,fieldState:S})=>{var h;return s.jsx($,{label:"Название тега",placeholder:"Название тега",isLoading:r,isSkeleton:g,"aria-required":!0,"aria-invalid":S.invalid,errorMessage:(h=S.error)==null?void 0:h.message,...n})}}),s.jsx(v,{name:"color",control:E,render:({field:n,fieldState:S})=>{var h;return s.jsx(Q,{label:"Цвет:",ref:n.ref,name:n.name,value:n.value,onChange:n.onChange,isLoading:r,isSkeleton:g,"aria-required":!0,"aria-invalid":S.invalid,errorMessage:(h=S.error)==null?void 0:h.message})}}),s.jsx(b.Footer,{children:s.jsxs(C.Buttons,{children:[s.jsx(x,{isSkeleton:g,isLoadingSkeleton:r,styleType:"delete",isFull:!0,onClick:()=>l(!0),children:"Удалить"}),s.jsx(x,{styleType:"border",isSkeleton:g,isLoadingSkeleton:r,isFull:!0,onClick:()=>T(),disabled:!p.isDirty,children:"Сбросить"}),s.jsx(x,{type:"submit",isLoading:i.isLoading,isSkeleton:g,isLoadingSkeleton:r,isFull:!0,disabled:!p.isDirty,children:"Обновить"})]})})]})]}),s.jsx(V,{title:"Удаление тега",description:"Вы уверены, что хотите удалить тег? Это действие нельзя будет отменить",buttonConfirmName:"Удалить",isOpen:j,isLoading:m.isLoading,onClose:()=>l(!1),onClickConfirm:O})]})},Z=(e,r)=>{const a=w();c.useEffect(()=>{e&&a(r)},[e,r,a])},de=()=>{const e=I(),r=R(e.id),[a,t]=c.useState(!1),[o,d,u]=z(r),[j,l]=c.useState(!1),i=a&&U(u),m=a?void 0:u;return Z(i,"/"),q(m),P(f.tagNameLoading,m),_(o==null?void 0:o.name),s.jsxs(s.Fragment,{children:[s.jsx(A,{title:(o==null?void 0:o.name)??null,isLoadingTitle:d,errorMessageTasksLoading:f.tasksLoading,notFoundMessage:G.tasks,tagId:r,headButtons:s.jsx(x,{size:"small",styleType:"border",onClick:()=>l(!0),children:"Редактировать тег"})}),s.jsx(Y,{initialData:o,isLoadingData:d,isOpen:j,onClose:()=>l(!1),onBeforeDelete:()=>t(!0),onAfterDelete:()=>t(!1)})]})};export{de as default};
